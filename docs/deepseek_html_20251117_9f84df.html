<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title> Projet MedFlow - Points Critiques</title>
    <style>
        /* Styles gÃ©nÃ©raux */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* En-tÃªte */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        /* Navigation */
        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-bottom: 3px solid #3498db;
        }
        
        .toc h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .toc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .toc-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: transform 0.3s ease;
        }
        
        .toc-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Sections */
        .section {
            padding: 40px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #3498db;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title::before {
            font-size: 1.5em;
        }
        
        /* Points critiques */
        .critical-point {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #e74c3c;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .critical-point:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .point-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .point-number {
            background: #e74c3c;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .point-title {
            color: #2c3e50;
            font-size: 1.4em;
            font-weight: 600;
            margin: 0;
        }
        
        /* Tableaux */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Code */
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
        
        .code-comment {
            color: #7f8c8d;
        }
        
        .code-keyword {
            color: #e74c3c;
        }
        
        .code-string {
            color: #27ae60;
        }
        
        /* Checklist */
        .checklist {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 12px 0;
            padding: 10px;
            background: white;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .checklist-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .checklist-icon {
            color: #27ae60;
            font-weight: bold;
        }
        
        /* Questions */
        .question {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .answer {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        /* Pied de page */
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .section {
                padding: 20px;
            }
            
            .toc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-tÃªte -->
        <div class="header">
            <h1>ğŸ¯ Projet MedFlow</h1>
            <div class="subtitle">Points Critiques du Projet - Version Mise Ã  Jour</div>
        </div>

        <!-- Table des matiÃ¨res -->
        <div class="toc">
            <h2>ğŸ“‹ Table des MatiÃ¨res</h2>
            <div class="toc-grid">
                <div class="toc-item">1. ğŸ—ï¸ Architecture GÃ©nÃ©rale</div>
                <div class="toc-item">2. ğŸ” Authentification & Autorisation</div>
                <div class="toc-item">3. ğŸ¢ Multi-Tenancy</div>
                <div class="toc-item">4. ğŸ‘¥ Gestion des RÃ´les</div>
                <div class="toc-item">5. ğŸ›¡ï¸ SÃ©curitÃ©</div>
                <div class="toc-item">6. ğŸ« Tokens JWT</div>
                <div class="toc-item">7. ğŸ—„ï¸ Architecture des ModÃ¨les</div>
                <div class="toc-item">8. âš¡ Points Techniques</div>
                <div class="toc-item">9. ğŸ¨ Choix de Design</div>
                <div class="toc-item">10. â“ Questions Probables</div>
            </div>
        </div>

        <!-- Section 1 -->
        <div class="section">
            <h2 class="section-title">ğŸ—ï¸ Architecture GÃ©nÃ©rale</h2>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Composant</th>
                            <th>Technologies</th>
                            <th>RÃ´le</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Backend</strong></td>
                            <td>Node.js + Express.js</td>
                            <td>Serveur API REST</td>
                        </tr>
                        <tr>
                            <td><strong>Base de donnÃ©es</strong></td>
                            <td>MongoDB + Mongoose</td>
                            <td>Stockage NoSQL</td>
                        </tr>
                        <tr>
                            <td><strong>Authentification</strong></td>
                            <td>JWT + bcrypt</td>
                            <td>Tokens sÃ©curisÃ©s + hashage</td>
                        </tr>
                        <tr>
                            <td><strong>Stockage fichiers</strong></td>
                            <td>Cloudinary</td>
                            <td>Images et PDF</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Structure du Projet</h3>
            <div class="code-block">
MedFlow/
â”œâ”€â”€ ğŸ“ backend/
â”‚   â”œâ”€â”€ ğŸ® controller/      # Logique mÃ©tier
â”‚   â”œâ”€â”€ ğŸ—ƒï¸ models/          # SchÃ©mas Mongoose
â”‚   â”œâ”€â”€ ğŸ›£ï¸ router/          # Routes Express
â”‚   â”œâ”€â”€ âš™ï¸ middelwares/     # Middlewares (auth, errors)
â”‚   â””â”€â”€ ğŸ› ï¸ utils/           # Utilitaires (JWT, etc.)
â”œâ”€â”€ ğŸ“Š dashboard/           # Interface Dashboard
â””â”€â”€ ğŸŒ frontend/            # Interface Patient publique
            </div>
        </div>

        <!-- Section 2 -->
        <div class="section">
            <h2 class="section-title">ğŸ” Authentification & Autorisation</h2>
            
            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">1</div>
                    <h3 class="point-title">SystÃ¨me de Double Token</h3>
                </div>
                <p><strong>ProblÃ¨me rÃ©solu :</strong> Gestion de deux types de tokens pour deux interfaces diffÃ©rentes</p>
                
                <div class="code-block">
<span class="code-comment">// Deux cookies diffÃ©rents selon le contexte</span>
- adminToken : Pour Dashboard (SuperAdmin, Admin, Doctor, Receptionist)
- patientToken : Pour Frontend Patient

<span class="code-comment">// Logique de sÃ©lection intelligente</span>
const isDashboardRoute = dashboardRoutes.some(route => fullPath.includes(route));
const isPatientRoute = patientRoutes.some(route => fullPath.includes(route));

if (isDashboardRoute) {
    <span class="code-comment">// EXIGE adminToken</span>
    selectedUser = adminUser;
} else if (isPatientRoute) {
    <span class="code-comment">// EXIGE patientToken</span>
    selectedUser = patientUser;
}
                </div>
                
                <p><strong>Avantages :</strong></p>
                <ul>
                    <li>ğŸ¯ SÃ©paration des contextes d'utilisation</li>
                    <li>ğŸ›¡ï¸ Isolation des sessions pour plus de sÃ©curitÃ©</li>
                    <li>ğŸ”„ FlexibilitÃ© : connexion simultanÃ©e possible</li>
                </ul>
            </div>

            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">2</div>
                    <h3 class="point-title">Middleware requireRole</h3>
                </div>
                
                <div class="code-block">
<span class="code-comment">// Usage typique dans les routes</span>
router.get('/doctors', 
    isAuthenticated, 
    requireRole(['Admin', 'SuperAdmin']), 
    getAllDoctors
);

<span class="code-comment">// ImplÃ©mentation du middleware</span>
const requireRole = (...allowedRoles) => {
    return (req, res, next) => {
        if (!allowedRoles.flat().includes(req.user.role)) {
            return next(new ErrorHandler("Access denied", 403));
        }
        next();
    };
};
                </div>
            </div>
        </div>

        <!-- Section 3 -->
        <div class="section">
            <h2 class="section-title">ğŸ¢ Multi-Tenancy (Isolation des DonnÃ©es)</h2>
            
            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">3</div>
                    <h3 class="point-title">Isolation par clinicId</h3>
                </div>
                
                <p><strong>Concept :</strong> Chaque clinique ne voit que ses propres donnÃ©es</p>
                
                <div class="code-block">
<span class="code-comment">// Exemple dans getAllDoctors</span>
const query = { role: "Doctor" };

<span class="code-comment">// Filtrage automatique selon le rÃ´le</span>
if ((req.user.role === "Admin" || req.user.role === "Receptionist") 
    && req.user.clinicId) {
    query.clinicId = req.user.clinicId;
}

<span class="code-comment">// SuperAdmin peut filtrer manuellement</span>
if (req.user.role === "SuperAdmin" && req.query.clinicId) {
    query.clinicId = req.query.clinicId;
}
                </div>
            </div>

            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">4</div>
                    <h3 class="point-title">Patients Multi-Cliniques</h3>
                </div>
                
                <p><strong>Innovation :</strong> Un patient peut prendre rendez-vous dans plusieurs cliniques</p>
                
                <div class="code-block">
<span class="code-comment">// Patient s'inscrit sans clinicId fixe</span>
let clinicIdToAssign = null;

<span class="code-comment">// Assignation automatique si crÃ©Ã© par Admin/Receptionist</span>
if (req.user.role === "Admin" || req.user.role === "Receptionist") {
    clinicIdToAssign = req.user.clinicId;
}

<span class="code-comment">// RÃ©cupÃ©ration via appointments</span>
const appointments = await Appointment.find({ clinicId: req.user.clinicId });
const patientIds = [...new Set(appointments.map(apt => apt.patientId))];
const patients = await User.find({ _id: { $in: patientIds }, role: "Patient" });
                </div>
            </div>
        </div>

        <!-- Section 4 -->
        <div class="section">
            <h2 class="section-title">ğŸ‘¥ Gestion des RÃ´les</h2>
            
            <h3>HiÃ©rarchie des RÃ´les</h3>
            <div class="code-block">
SuperAdmin
  â””â”€â”€ Admin (par clinique)
      â”œâ”€â”€ Doctor
      â””â”€â”€ Receptionist
Patient (indÃ©pendant)
            </div>

            <h3>Tableau des Permissions</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>FonctionnalitÃ©</th>
                            <th>SuperAdmin</th>
                            <th>Admin</th>
                            <th>Doctor</th>
                            <th>Receptionist</th>
                            <th>Patient</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CrÃ©er Clinic</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>CrÃ©er Doctor</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>Voir Doctors</td>
                            <td>Tous</td>
                            <td>Sa clinique</td>
                            <td>âŒ</td>
                            <td>Sa clinique</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td>CrÃ©er Appointment</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Section 5 -->
        <div class="section">
            <h2 class="section-title">ğŸ›¡ï¸ SÃ©curitÃ©</h2>
            
            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">5</div>
                    <h3 class="point-title">Hashage des Mots de Passe</h3>
                </div>
                
                <div class="code-block">
<span class="code-comment">// Middleware de prÃ©-sauvegarde Mongoose</span>
userSchema.pre("save", async function(next){
    if(!this.isModified("password")){
        return next();
    }
    this.password = await bcrypt.hash(this.password, 10);
    next();
});

<span class="code-comment">// MÃ©thode de comparaison</span>
userSchema.methods.comparePassword = async function(enteredPassword){
    return await bcrypt.compare(enteredPassword, this.password);
};
                </div>
            </div>

            <div class="critical-point">
                <div class="point-header">
                    <div class="point-number">6</div>
                    <h3 class="point-title">Validation Multi-Niveaux</h3>
                </div>
                
                <p><strong>Trois niveaux de validation :</strong></p>
                
                <div class="code-block">
<span class="code-comment">// 1. SchÃ©ma Mongoose</span>
email: {
    type: String,
    required: true,
    validate: [validator.isEmail, "Email invalide"],
}

<span class="code-comment">// 2. ContrÃ´leurs</span>
if(!firstName || !lastName || !email) {
    return next(new ErrorHandler("Champs obligatoires manquants", 400));
}

<span class="code-comment">// 3. Middleware</span>
if(!allowedRoles.includes(req.user.role)){
    return next(new ErrorHandler("AccÃ¨s refusÃ©", 403));
}
                </div>
            </div>
        </div>

        <!-- Section 10 -->
        <div class="section">
            <h2 class="section-title">â“ Questions Probables de l'Enseignant</h2>
            
            <div class="question">
                <strong>Q1 : "Comment garantissez-vous la sÃ©curitÃ© des donnÃ©es mÃ©dicales ?"</strong>
            </div>
            <div class="answer">
                <p><strong>RÃ©ponse structurÃ©e :</strong></p>
                <ul>
                    <li>ğŸ” <strong>Authentification forte</strong> : JWT avec expiration courte</li>
                    <li>ğŸ¯ <strong>Autorisation stricte</strong> : VÃ©rification du rÃ´le Ã  chaque requÃªte</li>
                    <li>ğŸ¢ <strong>Isolation multi-tenant</strong> : Filtrage systÃ©matique par clinicId</li>
                    <li>âœ… <strong>Validation multi-niveaux</strong> : SchÃ©ma, contrÃ´leur, middleware</li>
                    <li>ğŸ”’ <strong>Hashage sÃ©curisÃ©</strong> : bcrypt avec 10 rounds</li>
                    <li>ğŸŒ <strong>HTTPS obligatoire</strong> : En production avec secure cookies</li>
                </ul>
            </div>

            <div class="question">
                <strong>Q2 : "Pourquoi deux tokens au lieu d'un seul ?"</strong>
            </div>
            <div class="answer">
                <p><strong>Avantages techniques :</strong></p>
                <ul>
                    <li>ğŸ¯ <strong>SÃ©paration des contextes</strong> : Dashboard mÃ©dical vs Interface patient</li>
                    <li>ğŸ›¡ï¸ <strong>SÃ©curitÃ© renforcÃ©e</strong> : Isolation complÃ¨te des sessions</li>
                    <li>ğŸ”„ <strong>FlexibilitÃ© utilisateur</strong> : Connexion simultanÃ©e possible</li>
                    <li>ğŸ“Š <strong>Gestion des rÃ´les</strong> : Validation plus stricte et contextuelle</li>
                    <li>ğŸš€ <strong>Performance</strong> : Middleware optimisÃ© pour chaque type de route</li>
                </ul>
            </div>

            <div class="question">
                <strong>Q3 : "Quels sont les points faibles de votre architecture ?"</strong>
            </div>
            <div class="answer">
                <p><strong>Analyse critique et constructive :</strong></p>
                <ul>
                    <li>ğŸ§ª <strong>Tests automatisÃ©s</strong> : Manquants (prioritÃ© d'amÃ©lioration)</li>
                    <li>ğŸ’¾ <strong>SystÃ¨me de cache</strong> : Absent, toutes les requÃªtes en base</li>
                    <li>ğŸ›‘ <strong>Rate limiting</strong> : Non implÃ©mentÃ© contre les DDoS</li>
                    <li>ğŸ”„ <strong>Versioning API</strong> : Gestion des versions Ã  amÃ©liorer</li>
                    <li>ğŸ“Š <strong>Monitoring</strong> : Logs basiques, pas de centralisation</li>
                    <li>âš¡ <strong>Concurrence</strong> : Pas de verrouillage optimiste avancÃ©</li>
                </ul>
                <p><strong>AmÃ©liorations futures prÃ©vues :</strong> Redis pour le cache, tests Jest, Sentry pour le monitoring</p>
            </div>
        </div>

        <!-- Checklist -->
        <div class="section">
            <h2 class="section-title">ğŸ“ Checklist de PrÃ©paration</h2>
            
            <div class="checklist">
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Architecture gÃ©nÃ©rale (Backend/Frontend/Dashboard)</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>SystÃ¨me d'authentification Ã  double token</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Middleware isAuthenticated et sa logique</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>SystÃ¨me multi-tenant (isolation par clinicId)</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Permissions de chaque rÃ´le</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Gestion des patients multi-cliniques</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Mesures de sÃ©curitÃ© implÃ©mentÃ©es</span>
                </div>
                <div class="checklist-item">
                    <span class="checklist-icon">âœ…</span>
                    <span>Relations et modÃ¨les Mongoose</span>
                </div>
            </div>
        </div>

        <!-- Pied de page -->
        <div class="footer">
            <h2>ğŸš€ Bon courage pour votre dÃ©fense !</h2>
            <p>Vous maÃ®trisez parfaitement votre projet et ses innovations techniques.</p>
            <p><strong>Points forts Ã  mettre en avant :</strong> Double Token, Multi-Tenancy, Architecture modulaire, SÃ©curitÃ© renforcÃ©e</p>
        </div>
    </div>

    <script>
        // Script pour l'impression PDF
        function generatePDF() {
            window.print();
        }

        // Auto-gÃ©nÃ©ration du PDF aprÃ¨s chargement
        window.addEventListener('load', function() {
            console.log('Document prÃªt pour impression PDF');
            // DÃ©commenter la ligne suivante pour auto-imprimer
            // generatePDF();
        });
    </script>
</body>
</html>